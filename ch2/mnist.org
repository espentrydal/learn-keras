#+title: Mnist

* Training a model to recognize hand-written digits
** Loading dataset
#+begin_src jupyter-python :session py :tangle yes
from tensorflow.keras.datasets import mnist

(train_images, train_labels), (test_images, test_labels) = mnist.load_data()
#+end_src

#+RESULTS:

** Inspection of the training data
#+begin_src jupyter-python :session py :tangle yes
print(train_images.shape)
print(len(train_labels))
train_labels
#+end_src

#+RESULTS:
:RESULTS:
: (60000, 28, 28)
: 60000
: array([5, 0, 4, ..., 5, 6, 8], dtype=uint8)
:END:

** Building the network
#+begin_src jupyter-python :session py :tangle yes
from tensorflow import keras
from tensorflow.keras import layers

model = keras.Sequential([
    layers.Dense(512, activation="relu"),
    layers.Dense(10, activation="softmax")
])
#+end_src

#+RESULTS:

** Compilation step
#+begin_src jupyter-python :session py :tangle yes
model.compile(optimizer="rmsprop",
              loss="sparse_categorical_crossentropy",
              metrics=["accuracy"])
#+end_src

#+RESULTS:

** Preparing the image data
#+begin_src jupyter-python :session py :tangle yes
train_images = train_images.reshape((60_000, 28 * 28))
train_images = train_images.astype("float32") / 255
test_images = test_images.reshape((10_000, 28 * 28))
test_images = test_images.astype("float32") / 255
#+end_src

#+RESULTS:

** Fitting the model
#+begin_src jupyter-python :session py :tangle yes
model.fit(train_images, train_labels, epochs=5, batch_size=128)
#+end_src

#+RESULTS:
:RESULTS:
: Epoch 1/5
:   1/469 [..............................] - ETA: 1:08 - loss: 2.3590 - accuracy: 0.0781 29/469 [>.............................] - ETA: 0s - loss: 0.7942 - accuracy: 0.7804   57/469 [==>...........................] - ETA: 0s - loss: 0.6028 - accuracy: 0.8306 86/469 [====>.........................] - ETA: 0s - loss: 0.5092 - accuracy: 0.8558115/469 [======>.......................] - ETA: 0s - loss: 0.4554 - accuracy: 0.8700145/469 [========>.....................] - ETA: 0s - loss: 0.4166 - accuracy: 0.8805175/469 [==========>...................] - ETA: 0s - loss: 0.3874 - accuracy: 0.8895205/469 [============>.................] - ETA: 0s - loss: 0.3641 - accuracy: 0.8961235/469 [==============>...............] - ETA: 0s - loss: 0.3431 - accuracy: 0.9019265/469 [===============>..............] - ETA: 0s - loss: 0.3231 - accuracy: 0.9075295/469 [=================>............] - ETA: 0s - loss: 0.3079 - accuracy: 0.9115325/469 [===================>..........] - ETA: 0s - loss: 0.2973 - accuracy: 0.9141355/469 [=====================>........] - ETA: 0s - loss: 0.2866 - accuracy: 0.9173385/469 [=======================>......] - ETA: 0s - loss: 0.2776 - accuracy: 0.9199415/469 [=========================>....] - ETA: 0s - loss: 0.2688 - accuracy: 0.9223444/469 [===========================>..] - ETA: 0s - loss: 0.2611 - accuracy: 0.9243469/469 [==============================] - 1s 2ms/step - loss: 0.2545 - accuracy: 0.9259
: Epoch 2/5
:   1/469 [..............................] - ETA: 0s - loss: 0.0625 - accuracy: 0.9844 31/469 [>.............................] - ETA: 0s - loss: 0.1187 - accuracy: 0.9690 61/469 [==>...........................] - ETA: 0s - loss: 0.1151 - accuracy: 0.9670 91/469 [====>.........................] - ETA: 0s - loss: 0.1191 - accuracy: 0.9661121/469 [======>.......................] - ETA: 0s - loss: 0.1164 - accuracy: 0.9669151/469 [========>.....................] - ETA: 0s - loss: 0.1160 - accuracy: 0.9668181/469 [==========>...................] - ETA: 0s - loss: 0.1146 - accuracy: 0.9671210/469 [============>.................] - ETA: 0s - loss: 0.1155 - accuracy: 0.9665240/469 [==============>...............] - ETA: 0s - loss: 0.1130 - accuracy: 0.9665270/469 [================>.............] - ETA: 0s - loss: 0.1124 - accuracy: 0.9668296/469 [=================>............] - ETA: 0s - loss: 0.1100 - accuracy: 0.9675325/469 [===================>..........] - ETA: 0s - loss: 0.1101 - accuracy: 0.9675355/469 [=====================>........] - ETA: 0s - loss: 0.1076 - accuracy: 0.9684385/469 [=======================>......] - ETA: 0s - loss: 0.1081 - accuracy: 0.9682414/469 [=========================>....] - ETA: 0s - loss: 0.1068 - accuracy: 0.9687444/469 [===========================>..] - ETA: 0s - loss: 0.1055 - accuracy: 0.9691469/469 [==============================] - 1s 2ms/step - loss: 0.1048 - accuracy: 0.9691
: Epoch 3/5
:   1/469 [..............................] - ETA: 0s - loss: 0.0569 - accuracy: 0.9844 31/469 [>.............................] - ETA: 0s - loss: 0.0737 - accuracy: 0.9793 59/469 [==>...........................] - ETA: 0s - loss: 0.0704 - accuracy: 0.9792 88/469 [====>.........................] - ETA: 0s - loss: 0.0691 - accuracy: 0.9799118/469 [======>.......................] - ETA: 0s - loss: 0.0710 - accuracy: 0.9783148/469 [========>.....................] - ETA: 0s - loss: 0.0714 - accuracy: 0.9786178/469 [==========>...................] - ETA: 0s - loss: 0.0726 - accuracy: 0.9785208/469 [============>.................] - ETA: 0s - loss: 0.0718 - accuracy: 0.9787238/469 [==============>...............] - ETA: 0s - loss: 0.0714 - accuracy: 0.9787267/469 [================>.............] - ETA: 0s - loss: 0.0727 - accuracy: 0.9782297/469 [=================>............] - ETA: 0s - loss: 0.0715 - accuracy: 0.9786327/469 [===================>..........] - ETA: 0s - loss: 0.0708 - accuracy: 0.9790357/469 [=====================>........] - ETA: 0s - loss: 0.0698 - accuracy: 0.9791387/469 [=======================>......] - ETA: 0s - loss: 0.0698 - accuracy: 0.9791417/469 [=========================>....] - ETA: 0s - loss: 0.0698 - accuracy: 0.9791447/469 [===========================>..] - ETA: 0s - loss: 0.0695 - accuracy: 0.9792469/469 [==============================] - 1s 2ms/step - loss: 0.0695 - accuracy: 0.9793
: Epoch 4/5
:   1/469 [..............................] - ETA: 0s - loss: 0.0301 - accuracy: 0.9922 31/469 [>.............................] - ETA: 0s - loss: 0.0486 - accuracy: 0.9866 61/469 [==>...........................] - ETA: 0s - loss: 0.0457 - accuracy: 0.9866 91/469 [====>.........................] - ETA: 0s - loss: 0.0482 - accuracy: 0.9858121/469 [======>.......................] - ETA: 0s - loss: 0.0474 - accuracy: 0.9866151/469 [========>.....................] - ETA: 0s - loss: 0.0490 - accuracy: 0.9861181/469 [==========>...................] - ETA: 0s - loss: 0.0491 - accuracy: 0.9860211/469 [============>.................] - ETA: 0s - loss: 0.0488 - accuracy: 0.9859241/469 [==============>...............] - ETA: 0s - loss: 0.0497 - accuracy: 0.9855271/469 [================>.............] - ETA: 0s - loss: 0.0496 - accuracy: 0.9855303/469 [==================>...........] - ETA: 0s - loss: 0.0508 - accuracy: 0.9850333/469 [====================>.........] - ETA: 0s - loss: 0.0517 - accuracy: 0.9845363/469 [======================>.......] - ETA: 0s - loss: 0.0508 - accuracy: 0.9848393/469 [========================>.....] - ETA: 0s - loss: 0.0508 - accuracy: 0.9848423/469 [==========================>...] - ETA: 0s - loss: 0.0514 - accuracy: 0.9845453/469 [===========================>..] - ETA: 0s - loss: 0.0510 - accuracy: 0.9845469/469 [==============================] - 1s 2ms/step - loss: 0.0510 - accuracy: 0.9845
: Epoch 5/5
:   1/469 [..............................] - ETA: 1s - loss: 0.0325 - accuracy: 0.9922 31/469 [>.............................] - ETA: 0s - loss: 0.0342 - accuracy: 0.9892 61/469 [==>...........................] - ETA: 0s - loss: 0.0376 - accuracy: 0.9881 85/469 [====>.........................] - ETA: 0s - loss: 0.0382 - accuracy: 0.9881111/469 [======>.......................] - ETA: 0s - loss: 0.0387 - accuracy: 0.9880140/469 [=======>......................] - ETA: 0s - loss: 0.0395 - accuracy: 0.9879170/469 [=========>....................] - ETA: 0s - loss: 0.0400 - accuracy: 0.9880200/469 [===========>..................] - ETA: 0s - loss: 0.0396 - accuracy: 0.9880229/469 [=============>................] - ETA: 0s - loss: 0.0382 - accuracy: 0.9884259/469 [===============>..............] - ETA: 0s - loss: 0.0383 - accuracy: 0.9884289/469 [=================>............] - ETA: 0s - loss: 0.0379 - accuracy: 0.9883319/469 [===================>..........] - ETA: 0s - loss: 0.0378 - accuracy: 0.9884349/469 [=====================>........] - ETA: 0s - loss: 0.0388 - accuracy: 0.9881379/469 [=======================>......] - ETA: 0s - loss: 0.0383 - accuracy: 0.9882409/469 [=========================>....] - ETA: 0s - loss: 0.0382 - accuracy: 0.9882439/469 [===========================>..] - ETA: 0s - loss: 0.0376 - accuracy: 0.9883469/469 [==============================] - ETA: 0s - loss: 0.0383 - accuracy: 0.9881469/469 [==============================] - 1s 2ms/step - loss: 0.0383 - accuracy: 0.9881
: <keras.src.callbacks.History at 0x17c4c1000>
:END:

** Make predictions
#+begin_src jupyter-python :session py :tangle yes
test_digits = test_images[0:10]
predictions = model.predict(test_digits)
predictions[0]
#+end_src

#+RESULTS:
:RESULTS:
: 1/1 [==============================] - ETA: 0s1/1 [==============================] - 0s 25ms/step
: array([8.9392174e-09, 1.1892648e-09, 4.6861138e-07, 2.6151657e-04,
:        5.2199755e-11, 5.9366155e-08, 2.3554607e-13, 9.9973685e-01,
:        2.9603397e-08, 1.0202796e-06], dtype=float32)
:END:

#+begin_src jupyter-python :session py :tangle yes

predictions[0].argmax()
#+end_src

#+RESULTS:
: 7

#+begin_src jupyter-python :session py :tangle yes
predictions[0][7]
#+end_src

#+RESULTS:
: 0.99973685

#+begin_src jupyter-python :session py :tangle yes
test_labels[0]
#+end_src

#+RESULTS:
: 7

** Evaluating the model on new data

#+begin_src jupyter-python :session py
test_loss, test_acc = model.evaluate(test_images, test_labels)
print(f"test_acc: {test_acc}")
#+end_src

#+RESULTS:
:   1/313 [..............................] - ETA: 33s - loss: 0.0299 - accuracy: 0.9688 96/313 [========>.....................] - ETA: 0s - loss: 0.0934 - accuracy: 0.9710 208/313 [==================>...........] - ETA: 0s - loss: 0.0825 - accuracy: 0.9746313/313 [==============================] - 0s 483us/step - loss: 0.0665 - accuracy: 0.9798
: test_acc: 0.9797999858856201

* Display digit
#+begin_src jupyter-python :session py
from tensorflow.keras.datasets import mnist
(train_images, train_labels), (test_images, test_labels) = mnist.load_data()
#+end_src

#+RESULTS:

#+begin_src jupyter-python :session py
import matplotlib.pyplot as plt
digit = train_images[4]
plt.imshow(digit, cmap=plt.cm.binary)
plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/a43c7219ec22be957f5b91509da7f72a371e0794.png]]

#+begin_src jupyter-python :session py
train_labels[4]
#+end_src

#+RESULTS:
: 9
